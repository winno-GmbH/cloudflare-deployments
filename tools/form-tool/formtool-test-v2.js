!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.FormTool=t():e.FormTool=t()}(this,(()=>(()=>{"use strict";function e(e){const t=[];return Array.from(e.querySelectorAll("input, textarea")).filter((e=>!e.closest('[condition-active="false"]'))).forEach((e=>{const r=e.getAttribute("type"),s=e.required,i=e.value,o=e.getAttribute("data-validator"),c=e.getAttribute("name")||"",a=e.closest(".cmp--form-item.cmp")?.querySelector(".lbl")?.innerText||"";"radio"===r||"checkbox"===r?t.push({type:r,required:s,name:c,item:e,value:e.closest(".cmp")?.querySelector(".lbl")?.innerText||"",checked:e.checked,variable:e.getAttribute("data-variable")||void 0,customValidatorRegex:o||void 0,label:a}):t.push({type:r||null,required:s,value:i,customValidatorRegex:o||void 0,item:e,name:c,label:a,variable:e.getAttribute("data-variable")||void 0})})),t}function t(e){const t=[];return e.forEach((e=>{const r={type:e.type,value:e.value,label:e.label,name:e.name,required:e.required,item:e.item};if(e.variable&&(r.variable=e.variable),"radio"===e.type||"checkbox"===e.type){if(e.checked){const s=t.find((t=>t.label===e.label));s?s.value=`${s.value}, ${e.value}`:t.push(r)}}else t.push(r)})),t}function r(e,t,r){const s=document.evaluate(e,document,null,XPathResult.ORDERED_NODE_SNAPSHOT_TYPE,null);let i=[];for(let e=0;e<s.snapshotLength;e++)i.push(s.snapshotItem(e));return i.filter((e=>t.contains(e)))[r]||null}function s(e){const{value:t,required:r,customValidatorRegex:s,type:i}=e;if(r){if(s&&!new RegExp(s).test(t))return!1;if(""===t)return!1;if("email"===i&&!new RegExp("^[a-zA-Z0-9._-]+@[a-zA-Z0-9.-]+.[a-zA-Z]{2,6}$").test(t))return!1;if("tel"===i&&!new RegExp("^\\+?(\\d{1,4})?[\\s.-]?(\\d{1,4})?[\\s.-]?\\d{1,4}[\\s.-]?\\d{1,4}[\\s.-]?\\d{1,9}$").test(t))return!1;if("password"===i&&!new RegExp("^(?=.*[A-Za-z])(?=.*\\d)[A-Za-z\\d]{8,}$").test(t))return!1}return!0}function i(e,t){let r=!0;return e.forEach((e=>{let i=!0;i="checkbox"===e.type?function(e,t){const{required:r,name:s}=e,i=t.querySelectorAll(`input[name="${s}"]`);let o=!1;return i.forEach((e=>{e.checked&&(o=!0)})),!(r&&!o)}(e,t):"radio"===e.type?function(e,t){const{required:r,name:s}=e,i=t.querySelectorAll(`input[name="${s}"]`);let o=!1;return i.forEach((e=>{e.checked&&(o=!0)})),!(r&&!o)}(e,t):s(e);const o=e.item.closest(".lyt--form-item.lyt");if(o){const e=o.lastChild;i?e.classList.remove("error"):e.classList.add("error")}r&&(r=i)})),r}class o{constructor(e,t){this.currentStep=0,this.formStepPairs=[],this.form=e,this.accessKey=t,this.nextStepButton=e.querySelector(".wr_btn--form-control-next.wr_btn"),this.previousStepButton=e.querySelector(".wr_btn--form-control-prev.wr_btn"),this.submitButton=e.querySelector(".wr_btn--form-control-submit.wr_btn")}setStepsActivity(){if(!this.previousStepButton||!this.submitButton||!this.nextStepButton)return;this.previousStepButton.classList.add("hidden"),this.submitButton.classList.add("hidden"),this.nextStepButton.classList.remove("hidden");let e=0;if(this.formStepPairs.forEach(((t,r)=>{if(t.formStepNumber.classList.remove("completed"),t.formStepNumber.classList.remove("active"),t.formStepNumber.classList.remove("locked"),""!==t.id&&"true"!==t.formStep.getAttribute("condition-active"))t.formStepNumber.classList.add("hidden");else{t.formStepNumber.classList.remove("hidden");const r=t.formStepNumber.querySelector(".p--form-step-nr");r&&(r.textContent=(e+1).toString()),e++}r===this.currentStep?(t.formStepNumber.classList.add("active"),t.formStep.classList.remove("hidden")):(t.formStepNumber.classList.remove("locked"),t.formStep.classList.add("hidden"),r<this.currentStep?t.formStepNumber.classList.add("completed"):t.formStepNumber.classList.add("locked"))})),this.currentStep>0&&this.previousStepButton.classList.remove("hidden"),this.currentStep===this.formStepPairs.length-1)this.nextStepButton.classList.add("hidden"),this.submitButton.classList.remove("hidden");else{const t=this.formStepPairs[this.currentStep].formStepNumber.querySelector(".p--form-step-nr");t&&e===parseInt(t.textContent||"0")&&(this.nextStepButton.classList.add("hidden"),this.submitButton.classList.remove("hidden"))}}init(){const e=this.form.querySelectorAll(".cmp--form.cmp"),t=this.form.querySelectorAll(".cmp--form-step.cmp");e.forEach(((e,r)=>{this.formStepPairs.push({formStep:e,formStepNumber:t[r],name:e.getAttribute("name")||"",id:e.getAttribute("id")||""}),e.querySelectorAll("input[type=checkbox], input[type=radio]").forEach((e=>{e.getAttribute("conditional-step")&&e.addEventListener("change",(e=>{const t=e.target.getAttribute("conditional-step")?.replace(" ","").split(",")||[];this.formStepPairs.forEach((r=>{e.target.checked?t.includes(r.id)&&(r.formStepNumber.classList.remove("hidden"),r.formStep.setAttribute("condition-active","true")):t.includes(r.id)&&(r.formStepNumber.classList.add("hidden"),r.formStep.setAttribute("condition-active","false"))})),this.setStepsActivity()}))}))})),this.setStepsActivity(),localStorage.getItem("form-save-id")&&this.loadSavedForm()}async loadSavedForm(){try{const e=await fetch(`https://gecko-form-tool-be-new.vercel.app/api/forms/save-step/${localStorage.getItem("form-save-id")}`,{method:"GET",headers:{"Content-Type":"application/json"}}),t=await e.json();if(t.data){const e=function(e,t){let s="";return e.categories.forEach((e=>{const i=t.querySelector(`[name="${e.name}"]`);i&&e.form.forEach((t=>{const o=r(`//label[text()="${t.label}"]`,i,0);if(o&&""!==t.value)if(s=e.name,null===t.type){const e=o.closest(".cmp--ta.cmp"),r=e?.querySelector("textarea");r&&(r.value=t.value,e?.classList.add("filled"))}else if("checkbox"===t.type){const e=o.closest(".cmp--form-item.cmp");t.value.split(", ").forEach((t=>{const s=r(`//label[text()="${t}"]`,e,0),i=s?.closest(".cmp--cb.cmp"),o=i?.querySelector("input");o&&(o.checked=!0,i?.classList.add("checked"),o.dispatchEvent(new Event("change")))}))}else if("radio"===t.type){const e=o.closest(".cmp--form-item.cmp"),s=r(`//label[text()="${t.value}"]`,e,0),i=s?.closest(".cmp--rb.cmp"),c=i?.querySelector("input");c&&(c.checked=!0,i?.classList.add("checked"),c.dispatchEvent(new Event("change")))}else{const e=o.closest(".cmp--tf.cmp"),r=e?.querySelector("input");r&&(r.value=t.value,e?.classList.add("filled"))}}))})),s}(JSON.parse(t.data),this.form);this.setStepsActivity(),this.setCurrentStep(e)}}catch(e){console.error("Error loading saved form:",e)}}setCurrentStep(e){this.formStepPairs.forEach(((t,r)=>{t.name===e&&(this.currentStep=r)})),this.setStepsActivity()}async nextStep(){if(!i(e(this.formStepPairs[this.currentStep].formStep),this.form))return;for(let e=this.currentStep+1;e<this.formStepPairs.length;e++)if(!this.formStepPairs[e].formStepNumber.classList.contains("hidden")){this.currentStep=e;break}this.setStepsActivity();const r=[];this.formStepPairs.forEach((s=>{if(""===s.id||"true"===s.formStep.getAttribute("condition-active")){const i=t(e(s.formStep));r.push({name:s.name,form:i})}}));try{const e=await fetch("https://gecko-form-tool-be-new.vercel.app/api/forms/save-step",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({id:localStorage.getItem("form-save-id")||void 0,data:{categories:r},token:this.accessKey})}),t=await e.json();t.id&&localStorage.setItem("form-save-id",t.id)}catch(e){console.error("Error saving form step:",e)}}previousStep(){for(let e=this.currentStep-1;e>=0;e--)if(!this.formStepPairs[e].formStepNumber.classList.contains("hidden")){this.currentStep=e;break}this.setStepsActivity()}addEventListeners(){this.nextStepButton&&this.nextStepButton.addEventListener("click",(()=>this.nextStep())),this.previousStepButton&&this.previousStepButton.addEventListener("click",(()=>this.previousStep()))}}function c(e){const t=document.cookie.split("; ");for(let r=0;r<t.length;r++){const s=t[r].split("=");if(s[0]===e)return decodeURIComponent(s[1])}return null}function a(e){const t=e.querySelector(".wr_ico--tf-pre-lead.wr_ico, .wr_ico--tf-suf-lead.wr_ico, .wr_ico--tf-lead.wr_ico");if(!t)return;const r=function(e,t){let r=e;for(;r&&r.classList;){if(t.some((e=>r?.classList.contains(e))))return r;r=r.parentElement}return null}(t,["cmp--tf-pre","cmp--tf-main","cmp--tf-suf"]);if(!r)return;const s=r.querySelector("fieldset");if(!s)return;const i=r.firstChild,o=(r.offsetWidth,parseFloat(getComputedStyle(s).paddingLeft));let c=0;i&&(c=parseFloat(getComputedStyle(i).gap)||0);const a=t.offsetWidth+c+o;s.style.paddingLeft=`${a}px`}class n{constructor(e,t,r){this.serverUrl="https://gecko-form-tool-be-new.vercel.app/api/forms/submit",this.form=e,this.accessKey=t,this.captchaKey=r}getGoogleAdsData(){return{keyword:c("keyword")||void 0,campaign:c("campaignid")||void 0,location:c("loc_physical_ms")||void 0,adGroupID:c("adgroupid")||void 0,feedItemID:c("feeditemid")||void 0,extensionID:c("extensionid")||void 0,targetID:c("targetid")||void 0,locInterestMS:c("loc_interest_ms")||void 0,matchType:c("matchtype")||void 0,network:c("network")||void 0,device:c("device")||void 0,deviceModel:c("devicemodel")||void 0,gclid:c("gclid")||void 0,creative:c("creative")||void 0,placement:c("placement")||void 0,target:c("target")||void 0,adPosition:c("adposition")||void 0}}getMetaAdsData(){return{ad_id:c("fb_ad_id")||void 0,adset_id:c("fb_adset_id")||void 0,campaign_id:c("fb_campaign_id")||void 0,placement:c("fb_placement")||void 0,site_source_name:c("fb_site_source_name")||void 0,creative_id:c("fb_creative_id")||void 0,product_id:c("fb_product_id")||void 0,product_group_id:c("fb_product_group_id")||void 0,product_category:c("fb_product_category")||void 0,source:c("fb_source")||void 0,publisher_platform:c("fb_publisher_platform")||void 0,platform_position:c("fb_platform_position")||void 0,region:c("fb_region")||void 0,device_type:c("fb_device_type")||void 0,targeting:c("fb_targeting")||void 0,ad_format:c("fb_ad_format")||void 0,click_id:c("fb_click_id")||void 0,ad_name:c("fb_ad_name")||void 0,campaign_name:c("fb_campaign_name")||void 0,adset_name:c("fb_adset_name")||void 0}}async submitForm(e){try{const t=await fetch(this.serverUrl,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!t.ok)throw new Error("Network response was not ok");const r=await t.json();this.handleSuccess(r)}catch(e){console.error("Error during sending data:",e)}}handleSuccess(e){void 0!==window.gtag_report_conversion&&window.gtag_report_conversion(),void 0!==window.dataLayer&&window.dataLayer.push({event:"form_conversion"});const t=this.form.querySelector(".wr_btn--form-control-submit.wr_btn");if(t){const e=t.getAttribute("target-link");e&&(window.location.href=e)}this.form.querySelector(".cmp--form-steps.cmp")?.classList.add("hidden");this.form.querySelectorAll(".cmp--form.cmp").forEach((e=>{Array.from(e.classList).includes("cmp--form")?e.classList.add("hidden"):e.querySelector(".cmp--form.cmp")?.classList.add("hidden")})),this.form.querySelector(".cmp--btn-group.cmp")?.classList.add("hidden");const r=this.form.querySelector(".cmp--form-success.cmp");r&&(r.classList.remove("hidden"),r.scrollIntoView({behavior:"smooth",block:"center",inline:"center"}))}async handleSubmit(r){if(!i(e(this.form),this.form))return;const s=[];this.form.querySelectorAll(".cmp--form.cmp").forEach((r=>{if(""===r.getAttribute("id")||"true"===r.getAttribute("condition-active")){const i=t(e(r));s.push({name:r.getAttribute("name")||"",form:i})}}));try{window.fbq("track","Lead")}catch(e){}const o={formData:{categories:s},test:this.accessKey,token:this.captchaKey||void 0,id:localStorage.getItem("form-save-id")||void 0,googleAds:this.getGoogleAdsData(),metaAds:this.getMetaAdsData()},c=r.target.closest(".wr_btn--form-control-submit.wr_btn");if(!c)return;c.classList.add("pending"),c.setAttribute("disabled","true");const a=c.getAttribute("pending-text")||"Loading...";r.target.textContent=a,await this.submitForm(o)}}return(new class{constructor(){this.formSteps=null,this.formSubmission=null,this.currentScript=this.getCurrentScript();const e=this.currentScript.src,t=new URLSearchParams(e.split("?")[1]);this.accessKey=t.get("key")??"fd821fc7-53b3-4f4c-b3b0-f4adf10491c7",this.formName=t.get("form")??"Testformular",this.captchaKey=t.get("captcha-key"),console.log("Form Submit v0.2.6"),this.form=document.querySelector(`[name="${this.formName}"]`)}getCurrentScript(){if(document.currentScript)return document.currentScript;const e=document.getElementsByTagName("script");return e[e.length-1]}unwrapElements(){document.querySelectorAll('[unwrap="true"]').forEach((e=>{const t=e.parentNode;for(;e.firstChild;)t?.insertBefore(e.firstChild,e);t?.removeChild(e)}))}setupFormFields(){document.querySelectorAll(".cmp--tf.cmp").forEach((e=>{a(e);const t=e.querySelector(".lbl--tf-pre");if(t){new MutationObserver((t=>{t.forEach((t=>{"childList"!==t.type&&"characterData"!==t.type||a(e)}))})).observe(t,{childList:!0,characterData:!0})}e.querySelectorAll(".cmp--tf-pre.cmp, .cmp--tf-main.cmp, .cmp--tf-suf.cmp").forEach((t=>{const r=t.querySelector("input");r&&(r.placeholder&&t.classList.add("filled"),t.addEventListener("click",(()=>{t.classList.add("focused"),r.focus()})),r.addEventListener("focus",(()=>{t.classList.add("focused")})),r.addEventListener("blur",(()=>{r.placeholder&&t.classList.add("filled"),""===r.value?(t.classList.remove("focused"),t.classList.remove("filled")):t.classList.add("filled"),t.querySelector(".cmp--tf-md.cmp")&&!e.querySelector(".cmp--tf-md.cmp.hidden")||(s({type:r.type,required:r.required,value:r.value,name:r.name,label:r?.labels?.[0]?.textContent??"",item:r})?(t.classList.remove("error"),t.classList.add("success")):(t.classList.add("error"),t.classList.remove("success")))})))}))})),document.querySelectorAll(".cmp--cb.cmp").forEach((e=>{const t=e.querySelector("input");t&&e.addEventListener("click",(r=>{r.target!==t&&(t.checked=!t.checked),t.checked?e.classList.add("checked"):e.classList.remove("checked"),this.form?.querySelectorAll(`input[name="${t.name}"]`).forEach((e=>{e.dispatchEvent(new Event("change"))}))}))})),document.querySelectorAll(".cmp--rb.cmp").forEach((e=>{const t=e.querySelector("input");t&&e.addEventListener("click",(()=>{this.form?.querySelectorAll(`input[name="${t.name}"]`).forEach((e=>{const t=e.closest(".cmp--rb.cmp");t&&t.classList.remove("checked")})),t.checked=!0,this.form?.querySelectorAll(`input[name="${t.name}"]`).forEach((e=>{e.dispatchEvent(new Event("change"))})),e.classList.add("checked")}))})),document.querySelectorAll(".cmp--sw.cmp").forEach((e=>{const t=e.querySelector("input");t&&e.addEventListener("click",(r=>{r.target!==t&&(t.checked=!t.checked),t.checked?e.classList.add("checked"):e.classList.remove("checked"),this.form?.querySelectorAll(`input[name="${t.name}"]`).forEach((e=>{e.dispatchEvent(new Event("change"))}))}))})),document.querySelectorAll(".cmp--ct.cmp").forEach((e=>{const t=e.querySelector("input");t&&e.addEventListener("click",(r=>{r.target!==t&&(t.checked=!t.checked),t.checked?e.classList.add("checked"):e.classList.remove("checked"),this.form?.querySelectorAll(`input[name="${t.name}"]`).forEach((e=>{e.dispatchEvent(new Event("change"))}))}))})),document.querySelectorAll(".cmp--ta.cmp").forEach((e=>{const t=e.querySelector("textarea");t&&(e.addEventListener("click",(()=>{e.classList.add("focused"),t.focus()})),t.addEventListener("focus",(()=>{e.classList.add("focused")})),t.addEventListener("blur",(()=>{""===t.value?(e.classList.remove("focused"),e.classList.remove("filled")):e.classList.add("filled"),s({type:t.type,required:t.required,value:t.value,name:t.name,label:t?.labels?.[0]?.textContent??"",item:t})?(e.classList.remove("error"),e.classList.add("success")):(e.classList.add("error"),e.classList.remove("success"))})))})),this.setupSelectAndDatepicker()}setupSelectAndDatepicker(){document.querySelectorAll(".cmp--tf-md.cmp").forEach((e=>{let t=e.closest(".cmp--tf.cmp");t?.querySelector(".el--tf-md-overlay.el");t=e.closest(".cmp.cmp--tf-pre")??e.closest(".cmp.cmp--tf-suf")??t;const r=t?.querySelector("input")??t?.querySelector(".lbl--tf-pre.lbl")??t?.querySelector(".lbl--tf-suf.lbl"),s=Array.from(t?.querySelectorAll(".cmp--tf-md-option.cmp")||[]);0===s.length||"true"===e.getAttribute("generate")?"country-code"===e.getAttribute("data-type")?this.setupCountryCodePicker(r,e,s):this.setupDatePicker(r,t):this.setupOptions(r,t,s)}))}setupCountryCodePicker(e,t,r){const s=t.querySelector(".el--tf-md-overlay.el");fetch("https://cloudflare-test-7u4.pages.dev/tools/form-tool/country-codes.json").then((e=>e.json())).then((i=>{const o=t.lastChild?.lastChild;if(!o)return;o.innerHTML="";const c=i.filter((e=>!r.find((t=>t.textContent?.trim()===`${e.emoji} ${e.code} ${e.dial_code}`))));let a=r.map((e=>({item:e,seperator:!1})));if(a.length>0){const e=document.createElement("div");e.className="el--tf-md-sep el",a.push({item:e,seperator:!0})}a=a.concat(c.map((e=>{const t=document.createElement("div");return t.className="cmp--tf-md-option cmp",t.innerHTML=`\n              <div class="lyt--tf-md-option lyt">\n                <div class="wr_ico--tf-md-option wr_ico">\n                ${e.emoji}\n                </div>\n                <div class="wr_lbl--tf-md-option wr_lbl">\n                  <label class="lbl--tf-md-option lbl"> ${e.code} ${e.dial_code}</label>\n                </div>\n              </div>\n            `,{item:t,seperator:!1}}))),a.forEach((r=>{r.seperator||r.item.addEventListener("click",(i=>{i.stopPropagation();const c=function(e){return e.replace(/\s+/g," ").trim()}(r.item.textContent||"");e.value=c,e.innerHTML=c,o.classList.add("filled"),s?.classList.add("hidden"),t.classList.add("hidden"),o.classList.add("success"),o.classList.remove("error"),a.forEach((e=>{e.item.classList.remove("hidden"),e.item.classList.remove("checked")})),r.item.classList.add("checked"),e.dispatchEvent(new Event("blur"))})),o.appendChild(r.item)})),o.addEventListener("click",(()=>{s?.classList.remove("hidden"),t.classList.remove("hidden")})),s?.addEventListener("click",(r=>{r.stopPropagation(),s.classList.add("hidden"),t.classList.add("hidden"),e.dispatchEvent(new Event("blur"))}))}))}setupDatePicker(e,t){}setupOptions(e,t,r){r.forEach((s=>{s.addEventListener("click",(i=>{i.stopPropagation(),e.value=s.textContent?.trim()||"",t.classList.add("filled"),t.querySelector(".el--tf-md-overlay.el")?.classList.add("hidden"),t.querySelector(".cmp--tf-md.cmp")?.classList.add("hidden"),t.classList.add("success"),t.classList.remove("error"),r.forEach((e=>{e.classList.remove("hidden"),e.classList.remove("checked")})),e.dispatchEvent(new Event("blur")),s.classList.add("checked")}))})),e.addEventListener("input",(e=>{const t=e.target.value.toLowerCase(),s=r.find((e=>e.textContent?.trim().toLowerCase()===t));r.forEach((e=>{e.textContent?.trim().toLowerCase().includes(t)||s?e.classList.remove("hidden"):e.classList.add("hidden")}))})),t.addEventListener("click",(()=>{t.querySelector(".el--tf-md-overlay.el")?.classList.remove("hidden"),t.querySelector(".cmp--tf-md.cmp")?.classList.remove("hidden")})),t.querySelector(".el--tf-md-overlay.el")?.addEventListener("click",(r=>{r.stopPropagation(),t.querySelector(".el--tf-md-overlay.el")?.classList.add("hidden"),t.querySelector(".cmp--tf-md.cmp")?.classList.add("hidden"),e.dispatchEvent(new Event("blur"))}))}init(){if(!this.form)return;this.unwrapElements(),this.setupFormFields(),this.form.querySelector(".cmp--form-steps.cmp")&&(this.formSteps=new o(this.form,this.accessKey),this.formSteps.init(),this.formSteps.addEventListeners()),this.formSubmission=new n(this.form,this.accessKey,this.captchaKey);const e=this.form.querySelector(".wr_btn--form-control-submit.wr_btn");e&&e.addEventListener("click",(e=>this.formSubmission?.handleSubmit(e)))}}).init(),{}})()));